{% assign category = include.category %}
{% assign limit = include.limit %}
{% assign post_count = 0 %}

{% for post in site.posts %}
  {% if post.categories contains category %}
    {% assign post_count = post_count | plus: 1 %}
    
    {% if limit == nil or post_count <= limit %}
      {% assign post_excerpt = post.excerpt | strip_html | strip %}
      {% if post_excerpt == '' or post_excerpt == nil %}
        {% assign post_content = post.content | strip_html | strip %}
        {% assign post_excerpt = post_content | truncatewords: 40 %}
      {% else %}
        {% assign post_excerpt = post_excerpt | truncatewords: 40 %}
      {% endif %}
      
      {% assign post_image = post.image | default: post.thumbnail %}
      
      {% comment %} Handle known default images {% endcomment %}
      {% if post_image == nil or post_image == '' %}
        {% if post.title == 'Carbot 7: ROV' %}
          {% assign post_image = '/assets/images/Carbot7/bambulabs-ps1.png' %}
        {% elsif post.title == 'Stevens Pass Drive Forecasting' %}
          {% assign post_image = '/assets/images/drive_time_charts/drive_map.png' %}
        {% elsif post.title == 'Eventually Complete Digital Twin' %}
          {% assign post_image = '/assets/images/digital_twin/digital_twin.png' %}
        {% elsif post.title == 'Leading with Ideas' %}
          {% assign post_image = '/assets/images/ideation/lightbulbs_around_a_table.png' %}
        {% endif %}
      {% endif %}
      
<div class="post-preview">
  <div class="post-content">
    {% if post_image %}
    <div class="post-image">
      <img src="{{ post_image }}" alt="{{ post.title }}" class="post-thumbnail">
    </div>
    {% endif %}
    <div class="post-text">
      <h3><a href="{{ post.url }}">{{ post.title }}</a></h3>
      {% if post.date %}
      <div class="post-meta">
        <time datetime="{{ post.date | date: '%Y-%m-%d' }}">{{ post.date | date: "%B %-d, %Y" }}</time>
      </div>
      {% endif %}
      {% if post_excerpt %}
      <p class="post-excerpt">{{ post_excerpt }}</p>
      {% endif %}
      <a href="{{ post.url }}" class="read-more">Read more â†’</a>
    </div>
  </div>
</div>
    {% endif %}
  {% endif %}
{% endfor %}
